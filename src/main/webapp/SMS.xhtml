<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:p="http://primefaces.org/ui"
    xmlns:ui="http://java.sun.com/jsf/facelets">
<h:head>
    <h:outputStylesheet library="css" name="main.css" />
    <h:outputStylesheet library="css" name="chat.css" />
    <title>TODO title</title>
    <script type="text/javascript">
        function scrollTop() {
            var conversationContent = $(PrimeFaces.escapeClientId('layout'));
            conversationContent.scrollTop = conversationContent.scrollHeight;
            //conversationContent.animate({scrollTop: conversationContent.height()}, 5000);
            //conversationContent.scrollTop(conversationContent.height());
            //var conversationContent = document.getElementById('layout');
            //conversationContent.animate({scrollTop: 500000}, 8000);
            //$('#layout').animate({ scrollTop: $('#currentConversation').height() }, 400)
        }
    </script>
</h:head>
<h:body>
    <p:layout fullPage="true">
        <p:layoutUnit position="north" size="105" style="padding: 10px;">
            <h:form>
                <p:graphicImage height="50" library="img" name="logo.png" />
                <p:themeSwitcher
                    style="width: 200px; position: absolute; right: 0; top: 0; margin-left: auto; margin-right: 0;"
                    value="#{themeSwitcherManagedBean.theme}" var="t">
                    <f:selectItems itemLabel="#{theme.name}" itemValue="#{theme}"
                        value="#{themeSwitcherManagedBean.themes}" var="theme" />
                    <p:ajax event="change" />
                    <p:column>
                        <p:graphicImage height="50px"
                            value="/resources/img/theme/#{t.image}" />
                    </p:column>
                    <p:column>
                        <p:outputLabel value="#{t.name}" />
                    </p:column>
                </p:themeSwitcher>
                <p:menuButton value="pinguet62@gmail.com"
                    style="position: absolute; right: 0; top: 40px; margin-left: auto; margin-right: 0;">
                    <p:menuitem icon="ui-icon-person" value="Delete" />
                    <p:separator />
                    <p:menuitem actionListener="#{userManagedBean.logout}"
                        icon="ui-icon-close" url="/SMS.xhtml" value="DÃ©connexion" />
                </p:menuButton>
            </h:form>
        </p:layoutUnit>
        <p:layoutUnit collapsible="true" header="Contacts" position="west"
            resizable="true" size="200">
            <h:form prependId="false">
                <p:dataTable selectionMode="single" styleClass="no-header"
                    value="#{contactsManagedBean.contacts}" var="contact">
                    <p:ajax event="rowSelect"
                        listener="#{contactsManagedBean.onContactSelected}"
                        oncomplete="scrollTop()" update=":currentConversation" />
                    <p:ajax event="rowUnselect"
                        listener="#{contactsManagedBean.onContactUnselected}"
                        update=":currentConversation" />
                    <p:column>
                        <h:outputText value="#{contact.name}" />
                    </p:column>
                </p:dataTable>
            </h:form>
        </p:layoutUnit>
        <p:layoutUnit position="center">
            <p:layout>
                <p:layoutUnit id="layout" position="center" style="display: block;">
                    <h:form id="currentConversation" prependId="false">
                        <c:forEach items="#{contactsManagedBean.currentConversation}"
                            var="message">
                            <c:choose>
                                <c:when test="#{message.sent}">
                                    <div class="bubble-sent">
                                        <h:outputText value="#{message.content}" />
                                    </div>
                                    <br />
                                </c:when>
                                <c:otherwise>
                                    <div class="bubble-received">
                                        <h:outputText value="#{message.content}" />
                                    </div>
                                    <br />
                                </c:otherwise>
                            </c:choose>
                        </c:forEach>
                    </h:form>
                </p:layoutUnit>
                <p:layoutUnit position="south" resizable="true">
                    <p:panelGrid style="width: 100%">
                        <p:row>
                            <p:column style="width: 100%">
                                <p:inputTextarea autoResize="false"
                                    value="#{contactsManagedBean.currentConversation.input}"
                                    style="width: 100%" />
                            </p:column>
                            <p:column>
                                <p:commandButton value="Envoyer" />
                            </p:column>
                            <p:column>
                                <p:commandButton value="Annuler" />
                            </p:column>
                        </p:row>
                    </p:panelGrid>
                </p:layoutUnit>
            </p:layout>
        </p:layoutUnit>
        <p:layoutUnit position="south">
            TODO south
        </p:layoutUnit>
    </p:layout>
</h:body>
</html>